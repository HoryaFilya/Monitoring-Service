# Веб-сервис для подачи показаний счетчиков отопления, горячей и холодной воды

## Функциональные требования:
Разработайте веб-сервис для подачи показаний счетчиков отопления, горячей и холодной воды.

Показания можно подавать один раз в месяц.
Ранее поданые показания редактировать запрещено. 
Последние поданые показания считаются актуальными.
Пользователь может видеть только свои показания, администратор может видеть показания всех пользователей.
Создайте реализацию, которая соответствует описанным ниже требованиям и ограничениям:
- предусмотреть расширение перечня подаваемых показаний
- репозитории теперь должны писать ВСЕ сущности в БД PostgreSQL
- идентификаторы при сохранении в БД должны выдаваться через sequence
- DDL-скрипты на создание таблиц и скрипты на предзаполнение таблиц должны выполняться только инструментом миграции Liquibase
- скрипты миграции Luiqbase должны быть написаны в нотации XML или YAML
- скриптов миграции должно быть несколько. Как минимум один на создание всех таблиц, другой - на предзаполнение данными
- служебные таблицы должны быть в отдельной схеме
- таблицы сущностей хранить в схеме public запрещено
- в приложении должен быть docker-compose.yml, в котором должны быть прописаны инструкции для развертывания postgre в докере. Логин, пароль и база должны быть отличными от тех, что прописаны в образе по-умолчанию. Приложение должно работать с БД, развернутой в докере с указанными параметрами.
- приложение должно поддерживать конфиг-файлы. Всё, что относится к подключению БД, а также к миграциям, должно быть сконфигурировано через конфиг-файл.
- регистрация пользователя
- авторизация пользователя
- все взаимодействие должно теперь осуществляться через отправку HTTP запросов
- сервлеты должны принимать JSON и отдавать также JSON
- для сериализации и десереализации использовать jackson
- возвращать разные статус-коды
- реализовать валидацию входящих ДТО
- реализовать эндпоинт для получения актуальных показаний счетчиков
- реализовать эндпоинт подачи показаний
- реализовать эндпоинт просмотра показаний за конкретный месяц
- реализовать эндпоинт просмотра истории подачи показаний
- реализовать контроль прав пользователя
- аудит действий пользователя вынести в аспекты через аннотацию (авторизация, завершение работы, подача показаний, получение истории подачи показаний и т.д.)

## Нефункциональные требования:
- Unit-тестирование
- в тестах необходимо использовать test-containers

## Инструкция по запуску

1. Склонируйте репозиторий: `git clone https://github.com/HoryaFilya/Monitoring-Service.git`
2. Перейдите в директорию проекта: `cd Monitoring-Service`
3. Перейдите на нужную ветку: `git checkout task-3`
4. Поднимите контейнер с PostgreSQL: `docker-compose up`
4. Запустите приложение: `./gradlew jettyRun`

## Технологии

- Java 17
- Docker
- Lombok
- JUnit 5, Mockito, AssertJ, Testcontainers
- SQL и PostgreSQL
- Liquibase
- JDBC
- Jackson
- JWT
- AspectJ
- Jetty 11.0.17
- Servlets

## Эндпоинты

1. Регистрация пользователя  
   `POST /registration`
   ```json
   {
       "username": "test",
       "password": "test"
   }

2. Аутентификация пользователя
   `POST /login`
   ```json
   {
       "username": "test",
       "password": "test"
   }

- в роли администратора:
   ```json
   {
       "username": "admin",
       "password": "admin"
   }

3. Выход из аккаунта
   `POST /logout`

4. Получение актуальных показаний счетчиков
   `GET /indications/actual/{id}`

5. Получение истории подачи показаний счетчиков
   `GET /indications/history/{id}`

6. Получение показаний счетчиков за конкретный месяц
   `GET /indications/month/{month_number}/{id}`

7. Подача показаний
   `POST /indications`
   ```json
   {
       "heating": 100,
       "hotWater": 200,
       "coldWater": 300
   }

8. Получение аудита действий пользователей
   `GET /admin/audits`

9. Получение истории подачи показаний счетчиков пользователей
   `GET /admin/indications`


## Telegram
- @MishaShaikh
